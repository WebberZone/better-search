document.addEventListener("DOMContentLoaded",(function(){function e(e){e.innerHTML="",e.style.display="none",selectedIndex=-1;const t=e.closest('.search-form, form[role="search"]');if(t){const e=t.querySelector('input[name="s"]');e&&e.removeAttribute("aria-activedescendant")}}function t(e){e.forEach(((e,t)=>{if(t===selectedIndex){e.setAttribute("aria-selected","true"),e.classList.add("selected");const t=e.closest('.search-form, form[role="search"]');if(t){const n=t.querySelector('input[name="s"]');n&&n.setAttribute("aria-activedescendant",e.id)}}else e.setAttribute("aria-selected","false"),e.classList.remove("selected")}))}function n(n,r){fetch(bsearch_live_search.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"bsearch_live_search",s:n}).toString()}).then((function(e){return e.json()})).then((function(n){!function(n,r){if(r.innerHTML="",n.length>0){r.style.display="block";const e=document.createElement("ul");e.setAttribute("role","presentation"),n.forEach(((n,s)=>{const o=document.createElement("li");o.setAttribute("role","option"),o.setAttribute("aria-selected","false"),o.id=`search-suggestion-${s}`;const i=document.createElement("a");i.href=n.link,i.textContent=n.title,i.addEventListener("focus",(function(){selectedIndex=s,t(r.querySelectorAll("li"))})),o.appendChild(i),e.appendChild(o)})),r.appendChild(e),r.setAttribute("aria-label",`${n.length} search suggestions found`)}else e(r),r.setAttribute("aria-label","No search suggestions found")}(n,r)})).catch((function(t){e(r)}))}document.querySelectorAll('.search-form, form[role="search"]').forEach((r=>{const s=r.querySelector('input[name="s"]'),o=r.querySelector('input[type="submit"], button[type="submit"]');if(!s)return;const i=document.createElement("div");let c;i.className="bsearch-autocomplete-results",i.setAttribute("aria-live","polite"),i.setAttribute("role","listbox"),i.id="search-suggestions",s.setAttribute("aria-autocomplete","list"),s.setAttribute("aria-controls","search-suggestions"),o&&o.nextSibling?o.parentNode.insertBefore(i,o.nextSibling):s.parentNode.insertBefore(i,s.nextSibling);let a=-1;s.addEventListener("input",(function(){clearTimeout(c),c=setTimeout((()=>{const t=this.value;t.length>2?n(t,i):e(i)}),300)})),s.addEventListener("keydown",(function(r){if("Escape"===r.key)return r.preventDefault(),void e(i);const s=i.querySelectorAll("li");if("ArrowDown"===r.key&&this.value.length>2)if(r.preventDefault(),o)o.focus();else if(s.length){const e=s[0].querySelector("a");e&&(e.focus(),a=0,t(s))}else n(this.value,i)})),o&&(o.addEventListener("keydown",(function(n){if("Escape"===n.key)return n.preventDefault(),e(i),void s.focus();const r=i.querySelectorAll("li");if("ArrowDown"===n.key&&r.length>0){n.preventDefault();const e=r[0].querySelector("a");e&&(e.focus(),a=0,t(r))}else"ArrowUp"===n.key&&(n.preventDefault(),s.focus())})),i.addEventListener("DOMNodeInserted",(function(e){"A"===e.target.tagName&&e.target.removeAttribute("tabindex")}))),i.addEventListener("keydown",(function(n){const r=this.querySelectorAll("li");if(!r.length)return;const c=document.activeElement?.closest("li"),l=Array.from(r).indexOf(c);switch(n.key){case"ArrowDown":n.preventDefault(),l<r.length-1&&(r[l+1].querySelector("a").focus(),a=l+1,t(r));break;case"ArrowUp":n.preventDefault(),l>0?(r[l-1].querySelector("a").focus(),a=l-1,t(r)):(o?o.focus():s.focus(),a=-1,t(r));break;case"Escape":n.preventDefault(),e(i),s.focus();break}})),document.addEventListener("click",(function(t){r.contains(t.target)||i.contains(t.target)||e(i)})),s.addEventListener("focus",(function(){""!==i.innerHTML.trim()&&this.value.length>2&&(i.style.display="block")}))}))}));